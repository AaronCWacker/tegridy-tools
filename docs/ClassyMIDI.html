<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

  
  <title>ClassyMIDI API documentation</title>
  <meta name="description" content="" />


  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
</style>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/
</style>
  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>
  <style type="text/css">
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}
</style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>
<div id="container">
  


















  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#ClassyMIDI.all_features">all_features</a></li>
    <li class="mono"><a href="#ClassyMIDI.get_music_metrics">get_music_metrics</a></li>
    <li class="mono"><a href="#ClassyMIDI.get_signatures">get_signatures</a></li>
    <li class="mono"><a href="#ClassyMIDI.note_durations">note_durations</a></li>
    <li class="mono"><a href="#ClassyMIDI.number_of_notes">number_of_notes</a></li>
    <li class="mono"><a href="#ClassyMIDI.occupation_rate">occupation_rate</a></li>
    <li class="mono"><a href="#ClassyMIDI.pitch">pitch</a></li>
    <li class="mono"><a href="#ClassyMIDI.pitch_intervals">pitch_intervals</a></li>
    <li class="mono"><a href="#ClassyMIDI.polyphony_rate">polyphony_rate</a></li>
    <li class="mono"><a href="#ClassyMIDI.relative_duration">relative_duration</a></li>
    <li class="mono"><a href="#ClassyMIDI.remove_drum_empty_track">remove_drum_empty_track</a></li>
    <li class="mono"><a href="#ClassyMIDI.remove_duplicate_tracks">remove_duplicate_tracks</a></li>
    <li class="mono"><a href="#ClassyMIDI.remove_empty_track">remove_empty_track</a></li>
    <li class="mono"><a href="#ClassyMIDI.remove_file_duplicate_tracks">remove_file_duplicate_tracks</a></li>
    <li class="mono"><a href="#ClassyMIDI.walk">walk</a></li>
  </ul>

    </li>


    </ul>
  </div>

<article id="content">
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">ClassyMIDI</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI" class="source">
    <div class="codehilite"><pre><span></span><span class="c1">################################################################################</span>
<span class="c1"># </span>
<span class="c1"># ClassyMIDI MIDI Classifier</span>
<span class="c1">#</span>
<span class="c1"># Simple, yet fully-featured and powerful MIDI classifier Python 3 module.</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>
<span class="c1"># </span>
<span class="c1"># Requirements:</span>
<span class="c1">#</span>
<span class="c1"># git clone https://github.com/asigalov61/tegridy-tools</span>
<span class="c1"># pip install pypianoroll</span>
<span class="c1"># pip install texttable</span>
<span class="c1"># pip install fuzzywuzzy[speedup]</span>
<span class="c1"># pip install tqdm</span>
<span class="c1"># pip install pretty_midi</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>

<span class="c1">################################################################################</span>
<span class="c1"># </span>
<span class="c1"># Source code is courtesy of Rick McCoy of GitHub:</span>
<span class="c1"># https://github.com/ruiguo-bio/midi-miner/blob/master/track_separate.py#</span>
<span class="c1">################################################################################</span>
<span class="c1"># </span>
<span class="c1"># Project Los Angele</span>
<span class="c1"># Tegridy Code 2021</span>
<span class="c1"># License: GPL-3.0 License</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tqdm</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">auto</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>
<span class="kn">import</span> <span class="nn">secrets</span>
<span class="kn">import</span> <span class="nn">pypianoroll</span>
<span class="kn">from</span> <span class="nn">pypianoroll</span> <span class="kn">import</span> <span class="n">Multitrack</span>
<span class="kn">from</span> <span class="nn">texttable</span> <span class="kn">import</span> <span class="n">Texttable</span>

<span class="kn">from</span> <span class="nn">fuzzywuzzy</span> <span class="kn">import</span> <span class="n">fuzz</span>
<span class="kn">from</span> <span class="nn">fuzzywuzzy</span> <span class="kn">import</span> <span class="n">process</span>

<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="kn">import</span> <span class="nn">pretty_midi</span>
<span class="kn">import</span> <span class="nn">pypianoroll</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1">################################################################################</span>

<span class="k">def</span> <span class="nf">get_music_metrics</span><span class="p">(</span><span class="n">input_midi</span><span class="p">,</span> <span class="n">beat_resolution</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a midifile as an input and Returns the following metrics</span>
<span class="sd">    :param input_midi: Path to midi file</span>
<span class="sd">    :param beat_resolution:</span>
<span class="sd">    :param trac: Instrument number in the multi track midi file</span>
<span class="sd">    :return: The following metrics are returned</span>
<span class="sd">    1.) n_pitch_classes_used is the unique pitch classes used in a pianoroll.</span>
<span class="sd">    2.) polyphonic_rate ie ratio of the number of time steps where the number of pitches</span>
<span class="sd">        being played is larger than `threshold` to the total number of time steps in</span>
<span class="sd">        a pianoroll</span>
<span class="sd">    3.) in_scale_rate is the ratio of the number of nonzero entries that lie in a specific scale</span>
<span class="sd">        to the total number of nonzero entries in a pianoroll.</span>
<span class="sd">    4.) n_pitches_used is the the number of unique pitches used in a pianoroll.&quot;&quot;&quot;</span>

    <span class="n">midi_data</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">input_midi</span><span class="p">)</span>
    <span class="n">piano_roll</span> <span class="o">=</span> <span class="n">midi_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">track</span><span class="p">]</span><span class="o">.</span><span class="n">pianoroll</span>
    <span class="n">n_pitch_classes_used</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">n_pitch_classes_used</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">polyphonic_rate</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">polyphonic_rate</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">in_scale_rate</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">in_scale_rate</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">n_pitches_used</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">n_pitches_used</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">n_pitch_classes_used</span><span class="p">,</span> <span class="n">polyphonic_rate</span><span class="p">,</span> <span class="n">n_pitches_used</span><span class="p">,</span> <span class="n">in_scale_rate</span>
    <span class="p">]</span>
    <span class="n">metrics_table</span> <span class="o">=</span> <span class="p">[[</span>
        <span class="s2">&quot;n_pitch_classes_used&quot;</span><span class="p">,</span> <span class="s2">&quot;in_scale_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;polyphonic_rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_pitches_used&quot;</span>
    <span class="p">],</span> <span class="n">metrics</span><span class="p">]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Texttable</span><span class="p">()</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_rows</span><span class="p">(</span><span class="n">metrics_table</span><span class="p">)</span>
    <span class="c1">#print(table.draw())</span>

    <span class="k">return</span> <span class="n">piano_roll</span><span class="p">,</span> <span class="n">metrics</span>

<span class="k">def</span> <span class="nf">remove_drum_empty_track</span><span class="p">(</span><span class="n">midi_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    1. read pretty midi data, remove the drum track</span>
<span class="sd">    2. remove emtpy track,</span>
<span class="sd">    also remove track with fewer than 10% notes of the track</span>
<span class="sd">    with most notes</span>
<span class="sd">    ********</span>
<span class="sd">    Return: pretty_midi object, pypianoroll object</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pretty_midi_data</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1"> when read the file </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1">### remove drum track</span>
    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instrument</span><span class="o">.</span><span class="n">is_drum</span><span class="p">:</span>
            <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>

    <span class="c1">### remove empty track</span>
    <span class="n">pypiano_data</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">Multitrack</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pypiano_data</span><span class="o">.</span><span class="n">parse_pretty_midi</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions for pypianoroll in parsing the file </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">note_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> \
                  <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pypiano_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">]</span>

    <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">note_count</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

    <span class="n">remove_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pypiano_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">))[</span><span class="n">empty_indices</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">remove_indices</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">del</span> <span class="n">pypiano_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">pretty_midi_data</span><span class="p">,</span> <span class="n">pypiano_data</span>


<span class="k">def</span> <span class="nf">remove_empty_track</span><span class="p">(</span><span class="n">midi_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    1. remove emtpy track,</span>
<span class="sd">    also remove track with fewer than 10% notes of the track</span>
<span class="sd">    with most notes</span>
<span class="sd">    ********</span>
<span class="sd">    Return: pretty_midi object, pypianoroll object</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pretty_midi_data</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1"> when read the file </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>



    <span class="c1">### remove empty track</span>
    <span class="n">pypiano_data</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">Multitrack</span><span class="p">()</span>

    <span class="c1"># try:</span>
    <span class="c1">#     pypiano_data.parse_pretty_midi(pretty_midi_data)</span>
    <span class="c1"># except Exception as e:</span>
    <span class="c1">#     logger.info(f&#39;exceptions for pypianoroll in read the file {midi_file}&#39;)</span>
    <span class="c1">#     return None, None</span>

    <span class="c1"># note_count = [np.count_nonzero(np.any(track.pianoroll, axis=1)) \</span>
    <span class="c1">#               for track in pypiano_data.tracks]</span>
    <span class="c1">#</span>
    <span class="c1"># empty_indices = note_count / np.max(note_count) &lt; 0.1</span>

    <span class="n">note_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">)</span> \
                                <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">])</span>
                  <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">note_count</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">note_count</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instrument</span><span class="o">.</span><span class="n">program</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">instrument</span><span class="o">.</span><span class="n">is_drum</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">empty_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">all_less_than_10</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">pitch</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">all_less_than_10</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">all_less_than_10</span><span class="p">:</span>
            <span class="n">empty_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>



    <span class="c1"># remove_indices = np.arange(len(pypiano_data.tracks))[empty_indices]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="c1"># del pypiano_data.tracks[index]</span>
            <span class="k">del</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># pypiano_data.parse_pretty_midi(pretty_midi_data)        </span>

    <span class="k">return</span> <span class="n">pm</span><span class="p">,</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">from_pretty_midi</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span> <span class="c1">#pretty_midi_data)</span>

<span class="k">def</span> <span class="nf">remove_duplicate_tracks</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">file_names</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
        <span class="n">file_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">file_names</span> <span class="o">==</span> <span class="n">file_name</span><span class="p">]</span>
        <span class="n">number_notes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">file_features</span><span class="o">.</span><span class="n">num_notes</span><span class="p">)</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_notes</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
        <span class="n">h_pits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">number_h_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">h_pit</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_h_pit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_h_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">h_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

        <span class="n">l_pits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
            <span class="n">number_l_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">l_pit</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_l_pit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_l_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">l_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

        <span class="n">notes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">notes</span><span class="p">))</span>
        <span class="n">h_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">h_pits</span><span class="p">))</span>
        <span class="n">l_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l_pits</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">note_index</span> <span class="o">=</span> <span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
                <span class="n">h_pit_index</span> <span class="o">=</span> <span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="k">for</span> <span class="n">l_pit</span> <span class="ow">in</span> <span class="n">l_pits</span><span class="p">:</span>
                    <span class="n">l_pit_index</span> <span class="o">=</span> <span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">l_pit</span> <span class="o">==</span> <span class="n">l_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

                    <span class="n">index_intersect</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">,</span> <span class="p">(</span><span class="n">note_index</span><span class="p">,</span> <span class="n">h_pit_index</span><span class="p">,</span> <span class="n">l_pit_index</span><span class="p">))</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span>

    <span class="c1">### copy the labels in the tracks to be removed</span>

    <span class="n">melody_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sing&#39;</span><span class="p">,</span> <span class="s1">&#39;vocals&#39;</span><span class="p">,</span> <span class="s1">&#39;vocal&#39;</span><span class="p">,</span> <span class="s1">&#39;melody&#39;</span><span class="p">,</span> <span class="s1">&#39;melody:&#39;</span><span class="p">]</span>
    <span class="n">bass_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bass&#39;</span><span class="p">,</span> <span class="s1">&#39;bass:&#39;</span><span class="p">]</span>
    <span class="n">chord_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;chords&#39;</span><span class="p">,</span> <span class="s1">&#39;harmony&#39;</span><span class="p">]</span>
    <span class="n">drum_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;drum&#39;</span><span class="p">,</span> <span class="s1">&#39;drums&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">melody_track_name</span><span class="p">:</span>
                <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">bass_track_name</span><span class="p">:</span>

                <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">chord_track_name</span><span class="p">:</span>
                <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">drum_track_name</span><span class="p">:</span>
                <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">melody_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;melody&#39;</span>
        <span class="k">if</span> <span class="n">bass_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bass&#39;</span>
        <span class="k">if</span> <span class="n">chord_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;chord&#39;</span>
        <span class="k">if</span> <span class="n">drum_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;drum&#39;</span>


        <span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">features</span>


<span class="k">def</span> <span class="nf">remove_file_duplicate_tracks</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pm</span><span class="p">):</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">index_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">number_notes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">num_notes</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_notes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number_notes</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
    <span class="n">h_pits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">number_h_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">h_pit</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_h_pit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_h_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">h_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

    <span class="n">l_pits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
        <span class="n">number_l_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">l_pit</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_l_pit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_l_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">l_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

    <span class="n">notes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">notes</span><span class="p">))</span>
    <span class="n">h_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">h_pits</span><span class="p">))</span>
    <span class="n">l_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l_pits</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">note_index</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
            <span class="n">h_pit_index</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="k">for</span> <span class="n">l_pit</span> <span class="ow">in</span> <span class="n">l_pits</span><span class="p">:</span>
                <span class="n">l_pit_index</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">l_pit</span> <span class="o">==</span> <span class="n">l_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

                <span class="n">index_intersect</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">,</span> <span class="p">(</span><span class="n">note_index</span><span class="p">,</span> <span class="n">h_pit_index</span><span class="p">,</span> <span class="n">l_pit_index</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span>

    <span class="c1">### copy the labels in the tracks to be removed</span>

    <span class="n">melody_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sing&#39;</span><span class="p">,</span> <span class="s1">&#39;vocals&#39;</span><span class="p">,</span> <span class="s1">&#39;vocal&#39;</span><span class="p">,</span> <span class="s1">&#39;melody&#39;</span><span class="p">,</span> <span class="s1">&#39;melody:&#39;</span><span class="p">]</span>
    <span class="n">bass_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bass&#39;</span><span class="p">,</span> <span class="s1">&#39;bass:&#39;</span><span class="p">]</span>
    <span class="n">chord_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;chords&#39;</span><span class="p">,</span> <span class="s1">&#39;harmony&#39;</span><span class="p">]</span>
    <span class="n">drum_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;drum&#39;</span><span class="p">,</span> <span class="s1">&#39;drums&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">melody_track_name</span><span class="p">:</span>
                <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">bass_track_name</span><span class="p">:</span>

                <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">chord_track_name</span><span class="p">:</span>
                <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">drum_track_name</span><span class="p">:</span>
                <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">melody_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;melody&#39;</span>
        <span class="k">if</span> <span class="n">bass_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bass&#39;</span>
        <span class="k">if</span> <span class="n">chord_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;chord&#39;</span>

        <span class="k">if</span> <span class="n">drum_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;drum&#39;</span>


        <span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># logger.info(f&#39;indices are {indices}&#39;)</span>


        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="c1"># logger.info(f&#39;index is {index}&#39;)</span>
            <span class="n">index_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_to_remove</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># logger.info(f&#39;index is {index}&#39;)</span>
        <span class="k">del</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">features</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>

    <span class="k">return</span>

<span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">endname</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">endname</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span> <span class="ow">or</span> <span class="n">endname</span> <span class="o">==</span> <span class="s1">&#39;midi&#39;</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">file</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">files</span>


<span class="k">def</span> <span class="nf">relative_duration</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pianoroll_data data</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">note_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> \
                  <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">]</span>

    <span class="n">relative_durations</span> <span class="o">=</span> <span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">note_count</span><span class="p">)</span>

    <span class="n">relative_durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative_durations</span><span class="p">)</span>

    <span class="n">relative_durations</span> <span class="o">=</span> <span class="n">relative_durations</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">relative_durations</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative_durations</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">number_of_notes</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pretty-midi data</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">number_of_notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">))</span>

    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">number_of_notes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">)</span>

    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="n">number_of_notes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">number_of_notes</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">number_of_notes</span>

<span class="k">def</span> <span class="nf">occupation_rate</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pypianoroll data</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">occup_rates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
        <span class="n">piano_roll</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span>
        <span class="n">occup_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">piano_roll</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">occup_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occup_rates</span><span class="p">)</span>
    <span class="n">occup_rates</span> <span class="o">=</span> <span class="n">occup_rates</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">occup_rates</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">occup_rates</span>


<span class="k">def</span> <span class="nf">polyphony_rate</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pianoroll data</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">rates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
        <span class="n">piano_roll</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span>
        <span class="n">number_poly_note</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">rate</span> <span class="o">=</span> <span class="n">number_poly_note</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>

    <span class="n">rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>
    <span class="n">rates</span> <span class="o">=</span> <span class="n">rates</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">rates</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rates</span>


<span class="k">def</span> <span class="nf">pitch</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pypianoroll data</span>
<span class="sd">    Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 8)</span>
<span class="sd">        the 8 columns are highest pitch, lowest pitch, pitch mode, pitch std,</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">highest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lowest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># pitches = np.array([note.pitch] for note in instrument.notes)</span>

    <span class="k">def</span> <span class="nf">array_creation_by_count</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
        <span class="n">highest_note</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lowest_note</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pitch_array</span> <span class="o">=</span> <span class="n">array_creation_by_count</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">mode_pitch</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">pitch_array</span><span class="p">)</span>
        <span class="n">mode_pitch</span> <span class="o">=</span> <span class="n">mode_pitch</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># logger.info(mode_pitch)</span>

        <span class="n">std_pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pitch_array</span><span class="p">)</span>

        <span class="c1"># logger.info(std_pitch)</span>

        <span class="n">highest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">highest_note</span><span class="p">)</span>
        <span class="n">lowest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lowest_note</span><span class="p">)</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode_pitch</span><span class="p">)</span>
        <span class="n">stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std_pitch</span><span class="p">)</span>

    <span class="n">highest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">highest</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">lowest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lowest</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">highest_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">highest_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">highest</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">highest</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">highest</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lowest_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lowest_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">lowest</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lowest</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lowest</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">modes_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">modes_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">modes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stds_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stds_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">stds</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">highest</span><span class="p">,</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">highest_norm</span><span class="p">,</span> <span class="n">lowest_norm</span><span class="p">,</span> <span class="n">modes_norm</span><span class="p">,</span> <span class="n">stds_norm</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># logger.info(result.shape)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">pitch_intervals</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pretty-midi data here</span>
<span class="sd">     Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 5)</span>
<span class="sd">        the 5 columns are number of different intervals, largest interval,</span>
<span class="sd">        smallest interval, mode interval and interval std of this track,</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">different_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">largest_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">smallest_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mode_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">std_interval</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_intervals</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        threshold is the second for the space between two consecutive notes</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">note1</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">note2</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">note1</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">note2</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">note2</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;=</span> <span class="n">note1</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>

                    <span class="n">intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">note2</span><span class="o">.</span><span class="n">pitch</span> <span class="o">-</span> <span class="n">note1</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="n">get_intervals</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1">#         logger.info(f&#39;intervals is {intervals}&#39;)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">different_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">intervals</span><span class="p">)))</span>
            <span class="n">largest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
            <span class="n">smallest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
            <span class="n">mode_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">std_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">different_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">largest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">smallest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mode_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">std_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">different_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">different_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">largest_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">smallest_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">mode_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">std_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">different_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">different_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">different_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">different_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">different_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">largest_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">largest_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">largest_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">smallest_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">smallest_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">smallest_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mode_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">std_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">std_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">std_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_interval</span><span class="p">))</span>



    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">different_interval</span><span class="p">,</span> <span class="n">largest_interval</span><span class="p">,</span> <span class="n">smallest_interval</span><span class="p">,</span> \
                        <span class="n">mode_interval</span><span class="p">,</span> <span class="n">std_interval</span><span class="p">,</span> <span class="n">different_interval_norm</span><span class="p">,</span> \
                        <span class="n">largest_interval_norm</span><span class="p">,</span> <span class="n">smallest_interval_norm</span><span class="p">,</span> \
                        <span class="n">mode_interval_norm</span><span class="p">,</span> <span class="n">std_interval_norm</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">note_durations</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pretty-midi data here</span>
<span class="sd">    Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pretty-midi data</span>
<span class="sd">         Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 4)</span>
<span class="sd">        the 4 columns are longest, shortest, mean, std of note durations</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">longest_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">shortest_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mean_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">std_duration</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">notes</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">note</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">note</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">])</span>

        <span class="c1"># logger.info(f&#39;durations is {durations}&#39;)</span>

        <span class="n">longest_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">shortest_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">mean_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">std_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>


    <span class="n">longest_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span>
    <span class="n">shortest_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span>
    <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span>
    <span class="n">std_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">longest_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">longest_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">longest_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">shortest_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shortest_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">shortest_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mean_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mean_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">std_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">std_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">std_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">longest_duration</span><span class="p">,</span> <span class="n">shortest_duration</span><span class="p">,</span> <span class="n">mean_duration</span><span class="p">,</span> \
                        <span class="n">std_duration</span><span class="p">,</span> <span class="n">longest_duration_norm</span><span class="p">,</span> <span class="n">shortest_duration_norm</span><span class="p">,</span> \
                        <span class="n">mean_duration_norm</span><span class="p">,</span> <span class="n">std_duration_norm</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># logger.info(result.shape)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">note_durations</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pretty-midi data here</span>
<span class="sd">    Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pretty-midi data</span>
<span class="sd">         Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 4)</span>
<span class="sd">        the 4 columns are longest, shortest, mean, std of note durations</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">longest_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">shortest_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mean_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">std_duration</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">notes</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">note</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">note</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">])</span>

        <span class="n">longest_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">shortest_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">mean_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">std_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>


    <span class="n">longest_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span>
    <span class="n">shortest_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span>
    <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span>
    <span class="n">std_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">longest_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">longest_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">longest_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">shortest_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shortest_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">shortest_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mean_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mean_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">std_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">std_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">std_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">longest_duration</span><span class="p">,</span> <span class="n">shortest_duration</span><span class="p">,</span> <span class="n">mean_duration</span><span class="p">,</span> \
                        <span class="n">std_duration</span><span class="p">,</span> <span class="n">longest_duration_norm</span><span class="p">,</span> <span class="n">shortest_duration_norm</span><span class="p">,</span> \
                        <span class="n">mean_duration_norm</span><span class="p">,</span> <span class="n">std_duration_norm</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># logger.info(result.shape)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">all_features</span><span class="p">(</span><span class="n">midi_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    compute 34 features from midi data. Each track of each song have 30 features</span>
<span class="sd">    1 set of feature:</span>
<span class="sd">    duration, number of notes, occupation rate, polyphony rate,</span>
<span class="sd">    2 set of feature:</span>
<span class="sd">    Highest pitch, lowest pitch, pitch mode, pitch std,</span>
<span class="sd">    Highest pitch norm, lowest pitch norm, pitch mode norm, pitch std norm</span>
<span class="sd">    3 set of feature</span>
<span class="sd">    number of interval, largest interval,</span>
<span class="sd">    smallest interval, interval mode,</span>
<span class="sd">    number of interval norm, largest interval norm,</span>
<span class="sd">    smallest interval norm, interval mode norm</span>
<span class="sd">    4 set of feature</span>
<span class="sd">    longest note duration, shortest note duration,</span>
<span class="sd">     mean note duration, note duration std,</span>
<span class="sd">     longest note duration norm, shortest note duration norm,</span>
<span class="sd">     mean note duration norm, note duration std norm</span>
<span class="sd">    for all the normed feature,  it is the normalised features</span>
<span class="sd">    across different tracks within a midi file</span>
<span class="sd">    5 set of feature:</span>
<span class="sd">    track_programs,track_names,file_names,is_drum</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span> <span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">pm</span><span class="p">,</span> <span class="n">pypiano</span> <span class="o">=</span> <span class="n">remove_empty_track</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="sd">&#39;&#39;&#39;if len(pypiano.tracks) != len(pm.instruments):</span>
<span class="sd">        logger.info(f&#39;pypiano track length is {len(pypiano.tracks)} does not equal \</span>
<span class="sd">              to pretty_midi length {len(pm.instruments)} in {midi_file}&#39;)</span>
<span class="sd">        return None&#39;&#39;&#39;</span>

    <span class="c1"># logger.info(f&#39;the file is {midi_file}&#39;)</span>

    <span class="n">track_programs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">program</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">track_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">track_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="c1">#             if instrument.name.strip() is not &#39;&#39;:</span>
            <span class="c1">#                 track_names.append(instrument.name.rsplit()[0].lower())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">track_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions in find instrument name </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">track_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">track_names</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">midi_file</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">))[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">is_drum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">is_drum</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="n">rel_durations</span> <span class="o">=</span> <span class="n">relative_duration</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>
    <span class="n">number_notes</span> <span class="o">=</span> <span class="n">number_of_notes</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
    <span class="n">occup_rate</span> <span class="o">=</span> <span class="n">occupation_rate</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>
    <span class="n">poly_rate</span> <span class="o">=</span> <span class="n">polyphony_rate</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>

    <span class="n">pitch_features</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>

    <span class="n">pitch_interval_features</span> <span class="o">=</span> <span class="n">pitch_intervals</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>

    <span class="n">note_duration_features</span> <span class="o">=</span> <span class="n">note_durations</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>


    <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">track_programs</span><span class="p">,</span> <span class="n">track_names</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">is_drum</span><span class="p">,</span> \
                              <span class="n">rel_durations</span><span class="p">,</span> <span class="n">number_notes</span><span class="p">,</span> <span class="n">occup_rate</span><span class="p">,</span> \
                              <span class="n">poly_rate</span><span class="p">,</span> <span class="n">pitch_features</span><span class="p">,</span> \
                              <span class="n">pitch_interval_features</span><span class="p">,</span> <span class="n">note_duration_features</span>
                              <span class="p">))</span>

    <span class="c1"># logger.info(all_features.shape)</span>
    <span class="k">assert</span> <span class="n">all_features</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">34</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_features</span>

<span class="k">def</span> <span class="nf">get_signatures</span><span class="p">(</span><span class="n">MIDI_file</span><span class="p">):</span>    
    
    <span class="n">PR</span><span class="p">,</span> <span class="n">SIG</span> <span class="o">=</span> <span class="n">get_music_metrics</span><span class="p">(</span><span class="n">MIDI_file</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">all_features</span><span class="p">(</span><span class="n">MIDI_file</span><span class="p">)</span>

    <span class="n">SIG_SIMPLE</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">3</span><span class="p">])]</span>
    <span class="n">SIG_FULL</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># Duration</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">8</span><span class="p">])),</span> <span class="c1"># Highest Pitch</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">9</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">10</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">11</span><span class="p">])),</span>

              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">12</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># Highest pitch norm</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">13</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">14</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">15</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>

              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">16</span><span class="p">])),</span> <span class="c1"># number of interval</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">17</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">18</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">19</span><span class="p">])),</span>


              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">20</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># number of interval norm</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">21</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">22</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">23</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">24</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">25</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>

              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">26</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># mean note duration</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">27</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">28</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">29</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">30</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">31</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">32</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)]</span>
              
    <span class="k">return</span> <span class="n">SIG_SIMPLE</span><span class="p">,</span> <span class="n">SIG_FULL</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">PR</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.all_features">
    <p>def <span class="ident">all_features</span>(</p><p>midi_file)</p>
    </div>
    

    
  
    <div class="desc"><p>compute 34 features from midi data. Each track of each song have 30 features
1 set of feature:
duration, number of notes, occupation rate, polyphony rate,
2 set of feature:
Highest pitch, lowest pitch, pitch mode, pitch std,
Highest pitch norm, lowest pitch norm, pitch mode norm, pitch std norm
3 set of feature
number of interval, largest interval,
smallest interval, interval mode,
number of interval norm, largest interval norm,
smallest interval norm, interval mode norm
4 set of feature
longest note duration, shortest note duration,
 mean note duration, note duration std,
 longest note duration norm, shortest note duration norm,
 mean note duration norm, note duration std norm
for all the normed feature,  it is the normalised features
across different tracks within a midi file
5 set of feature:
track_programs,track_names,file_names,is_drum</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.all_features', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.all_features" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">all_features</span><span class="p">(</span><span class="n">midi_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    compute 34 features from midi data. Each track of each song have 30 features</span>
<span class="sd">    1 set of feature:</span>
<span class="sd">    duration, number of notes, occupation rate, polyphony rate,</span>
<span class="sd">    2 set of feature:</span>
<span class="sd">    Highest pitch, lowest pitch, pitch mode, pitch std,</span>
<span class="sd">    Highest pitch norm, lowest pitch norm, pitch mode norm, pitch std norm</span>
<span class="sd">    3 set of feature</span>
<span class="sd">    number of interval, largest interval,</span>
<span class="sd">    smallest interval, interval mode,</span>
<span class="sd">    number of interval norm, largest interval norm,</span>
<span class="sd">    smallest interval norm, interval mode norm</span>
<span class="sd">    4 set of feature</span>
<span class="sd">    longest note duration, shortest note duration,</span>
<span class="sd">     mean note duration, note duration std,</span>
<span class="sd">     longest note duration norm, shortest note duration norm,</span>
<span class="sd">     mean note duration norm, note duration std norm</span>
<span class="sd">    for all the normed feature,  it is the normalised features</span>
<span class="sd">    across different tracks within a midi file</span>
<span class="sd">    5 set of feature:</span>
<span class="sd">    track_programs,track_names,file_names,is_drum</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span> <span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">pm</span><span class="p">,</span> <span class="n">pypiano</span> <span class="o">=</span> <span class="n">remove_empty_track</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="sd">&#39;&#39;&#39;if len(pypiano.tracks) != len(pm.instruments):</span>
<span class="sd">        logger.info(f&#39;pypiano track length is {len(pypiano.tracks)} does not equal \</span>
<span class="sd">              to pretty_midi length {len(pm.instruments)} in {midi_file}&#39;)</span>
<span class="sd">        return None&#39;&#39;&#39;</span>

    <span class="c1"># logger.info(f&#39;the file is {midi_file}&#39;)</span>

    <span class="n">track_programs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">program</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">track_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">track_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="c1">#             if instrument.name.strip() is not &#39;&#39;:</span>
            <span class="c1">#                 track_names.append(instrument.name.rsplit()[0].lower())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">track_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions in find instrument name </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">track_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">track_names</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">midi_file</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">))[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">is_drum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">is_drum</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="n">rel_durations</span> <span class="o">=</span> <span class="n">relative_duration</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>
    <span class="n">number_notes</span> <span class="o">=</span> <span class="n">number_of_notes</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
    <span class="n">occup_rate</span> <span class="o">=</span> <span class="n">occupation_rate</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>
    <span class="n">poly_rate</span> <span class="o">=</span> <span class="n">polyphony_rate</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>

    <span class="n">pitch_features</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">(</span><span class="n">pypiano</span><span class="p">)</span>

    <span class="n">pitch_interval_features</span> <span class="o">=</span> <span class="n">pitch_intervals</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>

    <span class="n">note_duration_features</span> <span class="o">=</span> <span class="n">note_durations</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>


    <span class="n">all_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">track_programs</span><span class="p">,</span> <span class="n">track_names</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">is_drum</span><span class="p">,</span> \
                              <span class="n">rel_durations</span><span class="p">,</span> <span class="n">number_notes</span><span class="p">,</span> <span class="n">occup_rate</span><span class="p">,</span> \
                              <span class="n">poly_rate</span><span class="p">,</span> <span class="n">pitch_features</span><span class="p">,</span> \
                              <span class="n">pitch_interval_features</span><span class="p">,</span> <span class="n">note_duration_features</span>
                              <span class="p">))</span>

    <span class="c1"># logger.info(all_features.shape)</span>
    <span class="k">assert</span> <span class="n">all_features</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">34</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_features</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.get_music_metrics">
    <p>def <span class="ident">get_music_metrics</span>(</p><p>input_midi, beat_resolution, track=0)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes a midifile as an input and Returns the following metrics
:param input_midi: Path to midi file
:param beat_resolution:
:param trac: Instrument number in the multi track midi file
:return: The following metrics are returned
1.) n_pitch_classes_used is the unique pitch classes used in a pianoroll.
2.) polyphonic_rate ie ratio of the number of time steps where the number of pitches
    being played is larger than <code>threshold</code> to the total number of time steps in
    a pianoroll
3.) in_scale_rate is the ratio of the number of nonzero entries that lie in a specific scale
    to the total number of nonzero entries in a pianoroll.
4.) n_pitches_used is the the number of unique pitches used in a pianoroll.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.get_music_metrics', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.get_music_metrics" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_music_metrics</span><span class="p">(</span><span class="n">input_midi</span><span class="p">,</span> <span class="n">beat_resolution</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a midifile as an input and Returns the following metrics</span>
<span class="sd">    :param input_midi: Path to midi file</span>
<span class="sd">    :param beat_resolution:</span>
<span class="sd">    :param trac: Instrument number in the multi track midi file</span>
<span class="sd">    :return: The following metrics are returned</span>
<span class="sd">    1.) n_pitch_classes_used is the unique pitch classes used in a pianoroll.</span>
<span class="sd">    2.) polyphonic_rate ie ratio of the number of time steps where the number of pitches</span>
<span class="sd">        being played is larger than `threshold` to the total number of time steps in</span>
<span class="sd">        a pianoroll</span>
<span class="sd">    3.) in_scale_rate is the ratio of the number of nonzero entries that lie in a specific scale</span>
<span class="sd">        to the total number of nonzero entries in a pianoroll.</span>
<span class="sd">    4.) n_pitches_used is the the number of unique pitches used in a pianoroll.&quot;&quot;&quot;</span>

    <span class="n">midi_data</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">input_midi</span><span class="p">)</span>
    <span class="n">piano_roll</span> <span class="o">=</span> <span class="n">midi_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">track</span><span class="p">]</span><span class="o">.</span><span class="n">pianoroll</span>
    <span class="n">n_pitch_classes_used</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">n_pitch_classes_used</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">polyphonic_rate</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">polyphonic_rate</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">in_scale_rate</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">in_scale_rate</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">n_pitches_used</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">n_pitches_used</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">n_pitch_classes_used</span><span class="p">,</span> <span class="n">polyphonic_rate</span><span class="p">,</span> <span class="n">n_pitches_used</span><span class="p">,</span> <span class="n">in_scale_rate</span>
    <span class="p">]</span>
    <span class="n">metrics_table</span> <span class="o">=</span> <span class="p">[[</span>
        <span class="s2">&quot;n_pitch_classes_used&quot;</span><span class="p">,</span> <span class="s2">&quot;in_scale_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;polyphonic_rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_pitches_used&quot;</span>
    <span class="p">],</span> <span class="n">metrics</span><span class="p">]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Texttable</span><span class="p">()</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_rows</span><span class="p">(</span><span class="n">metrics_table</span><span class="p">)</span>
    <span class="c1">#print(table.draw())</span>

    <span class="k">return</span> <span class="n">piano_roll</span><span class="p">,</span> <span class="n">metrics</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.get_signatures">
    <p>def <span class="ident">get_signatures</span>(</p><p>MIDI_file)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.get_signatures', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.get_signatures" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_signatures</span><span class="p">(</span><span class="n">MIDI_file</span><span class="p">):</span>    
    
    <span class="n">PR</span><span class="p">,</span> <span class="n">SIG</span> <span class="o">=</span> <span class="n">get_music_metrics</span><span class="p">(</span><span class="n">MIDI_file</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">all_features</span><span class="p">(</span><span class="n">MIDI_file</span><span class="p">)</span>

    <span class="n">SIG_SIMPLE</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">SIG</span><span class="p">[</span><span class="mi">3</span><span class="p">])]</span>
    <span class="n">SIG_FULL</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># Duration</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">8</span><span class="p">])),</span> <span class="c1"># Highest Pitch</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">9</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">10</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">11</span><span class="p">])),</span>

              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">12</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># Highest pitch norm</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">13</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">14</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">15</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>

              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">16</span><span class="p">])),</span> <span class="c1"># number of interval</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">17</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">18</span><span class="p">])),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">19</span><span class="p">])),</span>


              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">20</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># number of interval norm</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">21</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">22</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">23</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">24</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">25</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>

              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">26</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># mean note duration</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">27</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">28</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">29</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">30</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">31</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">32</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)]</span>
              
    <span class="k">return</span> <span class="n">SIG_SIMPLE</span><span class="p">,</span> <span class="n">SIG_FULL</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">PR</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.note_durations">
    <p>def <span class="ident">note_durations</span>(</p><p>pretty_midi_data)</p>
    </div>
    

    
  
    <div class="desc"><p>use pretty-midi data here
Parameters
    ----------
    data : pretty-midi data
     Returns
    -------
    a numpy array in the shape of (number of tracks, 4)
    the 4 columns are longest, shortest, mean, std of note durations
    and the norm value across different tracks for those values</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.note_durations', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.note_durations" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">note_durations</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pretty-midi data here</span>
<span class="sd">    Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pretty-midi data</span>
<span class="sd">         Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 4)</span>
<span class="sd">        the 4 columns are longest, shortest, mean, std of note durations</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">longest_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">shortest_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mean_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">std_duration</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">notes</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">note</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">note</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">])</span>

        <span class="n">longest_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">shortest_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">mean_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>
        <span class="n">std_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">durations</span><span class="p">))</span>


    <span class="n">longest_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span>
    <span class="n">shortest_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span>
    <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span>
    <span class="n">std_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">longest_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">longest_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">longest_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">longest_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">shortest_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shortest_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">shortest_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shortest_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mean_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mean_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mean_duration</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">std_duration_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">std_duration_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">std_duration</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_duration</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_duration</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">longest_duration</span><span class="p">,</span> <span class="n">shortest_duration</span><span class="p">,</span> <span class="n">mean_duration</span><span class="p">,</span> \
                        <span class="n">std_duration</span><span class="p">,</span> <span class="n">longest_duration_norm</span><span class="p">,</span> <span class="n">shortest_duration_norm</span><span class="p">,</span> \
                        <span class="n">mean_duration_norm</span><span class="p">,</span> <span class="n">std_duration_norm</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># logger.info(result.shape)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.number_of_notes">
    <p>def <span class="ident">number_of_notes</span>(</p><p>pretty_midi_data)</p>
    </div>
    

    
  
    <div class="desc"><p>read pretty-midi data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.number_of_notes', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.number_of_notes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">number_of_notes</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pretty-midi data</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">number_of_notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">))</span>

    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">number_of_notes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">)</span>

    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="n">number_of_notes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">number_of_notes</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">number_of_notes</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.occupation_rate">
    <p>def <span class="ident">occupation_rate</span>(</p><p>pianoroll_data)</p>
    </div>
    

    
  
    <div class="desc"><p>read pypianoroll data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.occupation_rate', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.occupation_rate" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">occupation_rate</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pypianoroll data</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">occup_rates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
        <span class="n">piano_roll</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span>
        <span class="n">occup_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">piano_roll</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">occup_rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">occup_rates</span><span class="p">)</span>
    <span class="n">occup_rates</span> <span class="o">=</span> <span class="n">occup_rates</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">occup_rates</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">occup_rates</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.pitch">
    <p>def <span class="ident">pitch</span>(</p><p>pianoroll_data)</p>
    </div>
    

    
  
    <div class="desc"><p>read pypianoroll data
Returns
    -------
    a numpy array in the shape of (number of tracks, 8)
    the 8 columns are highest pitch, lowest pitch, pitch mode, pitch std,
    and the norm value across different tracks for those values</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.pitch', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.pitch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pitch</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pypianoroll data</span>
<span class="sd">    Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 8)</span>
<span class="sd">        the 8 columns are highest pitch, lowest pitch, pitch mode, pitch std,</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">highest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lowest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># pitches = np.array([note.pitch] for note in instrument.notes)</span>

    <span class="k">def</span> <span class="nf">array_creation_by_count</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
        <span class="n">highest_note</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lowest_note</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pitch_array</span> <span class="o">=</span> <span class="n">array_creation_by_count</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">mode_pitch</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">pitch_array</span><span class="p">)</span>
        <span class="n">mode_pitch</span> <span class="o">=</span> <span class="n">mode_pitch</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># logger.info(mode_pitch)</span>

        <span class="n">std_pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pitch_array</span><span class="p">)</span>

        <span class="c1"># logger.info(std_pitch)</span>

        <span class="n">highest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">highest_note</span><span class="p">)</span>
        <span class="n">lowest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lowest_note</span><span class="p">)</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode_pitch</span><span class="p">)</span>
        <span class="n">stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std_pitch</span><span class="p">)</span>

    <span class="n">highest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">highest</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">lowest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lowest</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stds</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">highest_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">highest_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">highest</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">highest</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">highest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">highest</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lowest_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lowest_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">lowest</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lowest</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lowest</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lowest</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">modes_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">modes_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">modes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stds_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stds_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">stds</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">highest</span><span class="p">,</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">highest_norm</span><span class="p">,</span> <span class="n">lowest_norm</span><span class="p">,</span> <span class="n">modes_norm</span><span class="p">,</span> <span class="n">stds_norm</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># logger.info(result.shape)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.pitch_intervals">
    <p>def <span class="ident">pitch_intervals</span>(</p><p>pretty_midi_data)</p>
    </div>
    

    
  
    <div class="desc"><p>use pretty-midi data here
Returns</p>
<hr>
<p>a numpy array in the shape of (number of tracks, 5)
   the 5 columns are number of different intervals, largest interval,
   smallest interval, mode interval and interval std of this track,
   and the norm value across different tracks for those values</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.pitch_intervals', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.pitch_intervals" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pitch_intervals</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pretty-midi data here</span>
<span class="sd">     Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a numpy array in the shape of (number of tracks, 5)</span>
<span class="sd">        the 5 columns are number of different intervals, largest interval,</span>
<span class="sd">        smallest interval, mode interval and interval std of this track,</span>
<span class="sd">        and the norm value across different tracks for those values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">different_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">largest_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">smallest_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mode_interval</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">std_interval</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_intervals</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        threshold is the second for the space between two consecutive notes</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">note1</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">note2</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">note1</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">note2</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">note2</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;=</span> <span class="n">note1</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>

                    <span class="n">intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">note2</span><span class="o">.</span><span class="n">pitch</span> <span class="o">-</span> <span class="n">note1</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="n">get_intervals</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1">#         logger.info(f&#39;intervals is {intervals}&#39;)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">different_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">intervals</span><span class="p">)))</span>
            <span class="n">largest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
            <span class="n">smallest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
            <span class="n">mode_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">intervals</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">std_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">different_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">largest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">smallest_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mode_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">std_interval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">different_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">different_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">largest_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">smallest_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">mode_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
    <span class="n">std_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std_interval</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">different_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">different_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">different_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">different_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">different_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">different_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">largest_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">largest_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">largest_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">largest_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">smallest_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">smallest_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">smallest_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">smallest_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mode_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mode_interval</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">std_interval_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">std_interval_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">std_interval</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_interval</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">std_interval</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">std_interval</span><span class="p">))</span>



    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">different_interval</span><span class="p">,</span> <span class="n">largest_interval</span><span class="p">,</span> <span class="n">smallest_interval</span><span class="p">,</span> \
                        <span class="n">mode_interval</span><span class="p">,</span> <span class="n">std_interval</span><span class="p">,</span> <span class="n">different_interval_norm</span><span class="p">,</span> \
                        <span class="n">largest_interval_norm</span><span class="p">,</span> <span class="n">smallest_interval_norm</span><span class="p">,</span> \
                        <span class="n">mode_interval_norm</span><span class="p">,</span> <span class="n">std_interval_norm</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">T</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.polyphony_rate">
    <p>def <span class="ident">polyphony_rate</span>(</p><p>pianoroll_data)</p>
    </div>
    

    
  
    <div class="desc"><p>use pianoroll data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.polyphony_rate', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.polyphony_rate" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">polyphony_rate</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    use pianoroll data</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">rates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
        <span class="n">piano_roll</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span>
        <span class="n">number_poly_note</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">rate</span> <span class="o">=</span> <span class="n">number_poly_note</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">piano_roll</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>

    <span class="n">rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>
    <span class="n">rates</span> <span class="o">=</span> <span class="n">rates</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">rates</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rates</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.relative_duration">
    <p>def <span class="ident">relative_duration</span>(</p><p>pianoroll_data)</p>
    </div>
    

    
  
    <div class="desc"><p>read pianoroll_data data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.relative_duration', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.relative_duration" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">relative_duration</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read pianoroll_data data</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">note_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> \
                  <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">]</span>

    <span class="n">relative_durations</span> <span class="o">=</span> <span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">note_count</span><span class="p">)</span>

    <span class="n">relative_durations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative_durations</span><span class="p">)</span>

    <span class="n">relative_durations</span> <span class="o">=</span> <span class="n">relative_durations</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">relative_durations</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pianoroll_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relative_durations</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.remove_drum_empty_track">
    <p>def <span class="ident">remove_drum_empty_track</span>(</p><p>midi_file)</p>
    </div>
    

    
  
    <div class="desc"><ol>
<li>read pretty midi data, remove the drum track</li>
<li>remove emtpy track,
also remove track with fewer than 10% notes of the track
with most notes</li>
</ol>
<hr>
<p>Return: pretty_midi object, pypianoroll object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.remove_drum_empty_track', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.remove_drum_empty_track" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_drum_empty_track</span><span class="p">(</span><span class="n">midi_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    1. read pretty midi data, remove the drum track</span>
<span class="sd">    2. remove emtpy track,</span>
<span class="sd">    also remove track with fewer than 10% notes of the track</span>
<span class="sd">    with most notes</span>
<span class="sd">    ********</span>
<span class="sd">    Return: pretty_midi object, pypianoroll object</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pretty_midi_data</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1"> when read the file </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1">### remove drum track</span>
    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">instrument</span><span class="o">.</span><span class="n">is_drum</span><span class="p">:</span>
            <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>

    <span class="c1">### remove empty track</span>
    <span class="n">pypiano_data</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">Multitrack</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pypiano_data</span><span class="o">.</span><span class="n">parse_pretty_midi</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions for pypianoroll in parsing the file </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">note_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">pianoroll</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> \
                  <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">pypiano_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">]</span>

    <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">note_count</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

    <span class="n">remove_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pypiano_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">))[</span><span class="n">empty_indices</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">remove_indices</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">del</span> <span class="n">pypiano_data</span><span class="o">.</span><span class="n">tracks</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">pretty_midi_data</span><span class="p">,</span> <span class="n">pypiano_data</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.remove_duplicate_tracks">
    <p>def <span class="ident">remove_duplicate_tracks</span>(</p><p>features, replace=False)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.remove_duplicate_tracks', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.remove_duplicate_tracks" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_duplicate_tracks</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">file_names</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
        <span class="n">file_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">file_names</span> <span class="o">==</span> <span class="n">file_name</span><span class="p">]</span>
        <span class="n">number_notes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">file_features</span><span class="o">.</span><span class="n">num_notes</span><span class="p">)</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_notes</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
        <span class="n">h_pits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">number_h_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">h_pit</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_h_pit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_h_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">h_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

        <span class="n">l_pits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
            <span class="n">number_l_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">l_pit</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_l_pit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_l_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">l_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

        <span class="n">notes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">notes</span><span class="p">))</span>
        <span class="n">h_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">h_pits</span><span class="p">))</span>
        <span class="n">l_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l_pits</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="n">note_index</span> <span class="o">=</span> <span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
                <span class="n">h_pit_index</span> <span class="o">=</span> <span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="k">for</span> <span class="n">l_pit</span> <span class="ow">in</span> <span class="n">l_pits</span><span class="p">:</span>
                    <span class="n">l_pit_index</span> <span class="o">=</span> <span class="n">file_features</span><span class="p">[</span><span class="n">file_features</span><span class="o">.</span><span class="n">l_pit</span> <span class="o">==</span> <span class="n">l_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

                    <span class="n">index_intersect</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">,</span> <span class="p">(</span><span class="n">note_index</span><span class="p">,</span> <span class="n">h_pit_index</span><span class="p">,</span> <span class="n">l_pit_index</span><span class="p">))</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span>

    <span class="c1">### copy the labels in the tracks to be removed</span>

    <span class="n">melody_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sing&#39;</span><span class="p">,</span> <span class="s1">&#39;vocals&#39;</span><span class="p">,</span> <span class="s1">&#39;vocal&#39;</span><span class="p">,</span> <span class="s1">&#39;melody&#39;</span><span class="p">,</span> <span class="s1">&#39;melody:&#39;</span><span class="p">]</span>
    <span class="n">bass_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bass&#39;</span><span class="p">,</span> <span class="s1">&#39;bass:&#39;</span><span class="p">]</span>
    <span class="n">chord_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;chords&#39;</span><span class="p">,</span> <span class="s1">&#39;harmony&#39;</span><span class="p">]</span>
    <span class="n">drum_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;drum&#39;</span><span class="p">,</span> <span class="s1">&#39;drums&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">melody_track_name</span><span class="p">:</span>
                <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">bass_track_name</span><span class="p">:</span>

                <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">chord_track_name</span><span class="p">:</span>
                <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">drum_track_name</span><span class="p">:</span>
                <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">melody_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;melody&#39;</span>
        <span class="k">if</span> <span class="n">bass_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bass&#39;</span>
        <span class="k">if</span> <span class="n">chord_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;chord&#39;</span>
        <span class="k">if</span> <span class="n">drum_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;drum&#39;</span>


        <span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">features</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.remove_empty_track">
    <p>def <span class="ident">remove_empty_track</span>(</p><p>midi_file)</p>
    </div>
    

    
  
    <div class="desc"><ol>
<li>remove emtpy track,
also remove track with fewer than 10% notes of the track
with most notes</li>
</ol>
<hr>
<p>Return: pretty_midi object, pypianoroll object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.remove_empty_track', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.remove_empty_track" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_empty_track</span><span class="p">(</span><span class="n">midi_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    1. remove emtpy track,</span>
<span class="sd">    also remove track with fewer than 10% notes of the track</span>
<span class="sd">    with most notes</span>
<span class="sd">    ********</span>
<span class="sd">    Return: pretty_midi object, pypianoroll object</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pretty_midi_data</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exceptions </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1"> when read the file </span><span class="si">{</span><span class="n">midi_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>



    <span class="c1">### remove empty track</span>
    <span class="n">pypiano_data</span> <span class="o">=</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">Multitrack</span><span class="p">()</span>

    <span class="c1"># try:</span>
    <span class="c1">#     pypiano_data.parse_pretty_midi(pretty_midi_data)</span>
    <span class="c1"># except Exception as e:</span>
    <span class="c1">#     logger.info(f&#39;exceptions for pypianoroll in read the file {midi_file}&#39;)</span>
    <span class="c1">#     return None, None</span>

    <span class="c1"># note_count = [np.count_nonzero(np.any(track.pianoroll, axis=1)) \</span>
    <span class="c1">#               for track in pypiano_data.tracks]</span>
    <span class="c1">#</span>
    <span class="c1"># empty_indices = note_count / np.max(note_count) &lt; 0.1</span>

    <span class="n">note_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">)</span> \
                                <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">])</span>
                  <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">note_count</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">empty_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">note_count</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">note_count</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instrument</span><span class="o">.</span><span class="n">program</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">instrument</span><span class="o">.</span><span class="n">is_drum</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">empty_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">all_less_than_10</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">instrument</span><span class="o">.</span><span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">pitch</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">all_less_than_10</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">all_less_than_10</span><span class="p">:</span>
            <span class="n">empty_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>



    <span class="c1"># remove_indices = np.arange(len(pypiano_data.tracks))[empty_indices]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">empty_indices</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="c1"># del pypiano_data.tracks[index]</span>
            <span class="k">del</span> <span class="n">pretty_midi_data</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># pypiano_data.parse_pretty_midi(pretty_midi_data)        </span>

    <span class="k">return</span> <span class="n">pm</span><span class="p">,</span> <span class="n">pypianoroll</span><span class="o">.</span><span class="n">from_pretty_midi</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span> <span class="c1">#pretty_midi_data)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.remove_file_duplicate_tracks">
    <p>def <span class="ident">remove_file_duplicate_tracks</span>(</p><p>features, pm)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.remove_file_duplicate_tracks', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.remove_file_duplicate_tracks" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_file_duplicate_tracks</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pm</span><span class="p">):</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">index_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">number_notes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">num_notes</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_notes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number_notes</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
    <span class="n">h_pits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">number_h_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">h_pit</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_h_pit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_h_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">h_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

    <span class="n">l_pits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
        <span class="n">number_l_pit</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">l_pit</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">number_l_pit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number_l_pit</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">l_pits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

    <span class="n">notes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">notes</span><span class="p">))</span>
    <span class="n">h_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">h_pits</span><span class="p">))</span>
    <span class="n">l_pits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">l_pits</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">note_index</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">num_notes</span> <span class="o">==</span> <span class="n">note</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">h_pit</span> <span class="ow">in</span> <span class="n">h_pits</span><span class="p">:</span>
            <span class="n">h_pit_index</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">h_pit</span> <span class="o">==</span> <span class="n">h_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="k">for</span> <span class="n">l_pit</span> <span class="ow">in</span> <span class="n">l_pits</span><span class="p">:</span>
                <span class="n">l_pit_index</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">l_pit</span> <span class="o">==</span> <span class="n">l_pit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

                <span class="n">index_intersect</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">,</span> <span class="p">(</span><span class="n">note_index</span><span class="p">,</span> <span class="n">h_pit_index</span><span class="p">,</span> <span class="n">l_pit_index</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_intersect</span><span class="p">)</span>

    <span class="c1">### copy the labels in the tracks to be removed</span>

    <span class="n">melody_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sing&#39;</span><span class="p">,</span> <span class="s1">&#39;vocals&#39;</span><span class="p">,</span> <span class="s1">&#39;vocal&#39;</span><span class="p">,</span> <span class="s1">&#39;melody&#39;</span><span class="p">,</span> <span class="s1">&#39;melody:&#39;</span><span class="p">]</span>
    <span class="n">bass_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bass&#39;</span><span class="p">,</span> <span class="s1">&#39;bass:&#39;</span><span class="p">]</span>
    <span class="n">chord_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">,</span> <span class="s1">&#39;chords&#39;</span><span class="p">,</span> <span class="s1">&#39;harmony&#39;</span><span class="p">]</span>
    <span class="n">drum_track_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;drum&#39;</span><span class="p">,</span> <span class="s1">&#39;drums&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">melody_track_name</span><span class="p">:</span>
                <span class="n">melody_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">bass_track_name</span><span class="p">:</span>

                <span class="n">bass_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">chord_track_name</span><span class="p">:</span>
                <span class="n">chord_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">drum_track_name</span><span class="p">:</span>
                <span class="n">drum_track</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">melody_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;melody&#39;</span>
        <span class="k">if</span> <span class="n">bass_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bass&#39;</span>
        <span class="k">if</span> <span class="n">chord_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;chord&#39;</span>

        <span class="k">if</span> <span class="n">drum_track</span><span class="p">:</span>
            <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="s1">&#39;trk_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;drum&#39;</span>


        <span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># logger.info(f&#39;indices are {indices}&#39;)</span>


        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="c1"># logger.info(f&#39;index is {index}&#39;)</span>
            <span class="n">index_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_to_remove</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># logger.info(f&#39;index is {index}&#39;)</span>
        <span class="k">del</span> <span class="n">pm</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="n">features</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>

    <span class="k">return</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ClassyMIDI.walk">
    <p>def <span class="ident">walk</span>(</p><p>folder_name)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ClassyMIDI.walk', this);">Show source &equiv;</a></p>
  <div id="source-ClassyMIDI.walk" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">endname</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">endname</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span> <span class="ow">or</span> <span class="n">endname</span> <span class="o">==</span> <span class="s1">&#39;midi&#39;</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">file</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">files</span>
</pre></div>

  </div>
</div>

  </div>
  


  </section>
</article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Generated by <a href="https://github.com/timothycrosley/pdocs">pdocs 1.1.1</a>
    </p>
  </footer>
</div>
</body>
</html>